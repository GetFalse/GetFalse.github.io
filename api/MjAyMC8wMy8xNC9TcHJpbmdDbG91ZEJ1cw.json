{"title":"SpringCloudBus","date":"2020-03-14T11:01:11.000Z","date_formatted":{"ll":"Mar 14, 2020","L":"03/14/2020","MM-DD":"03-14"},"link":"2020/03/14/SpringCloudBus","comments":true,"tags":["Bus","Config"],"categories":["SpringCloud"],"updated":"2020-03-14T07:19:38.728Z","content":"<p>此篇承接上一篇SpringCloudConfig。</p>\n<h1 id=\"什么是springcloudbus\">什么是SpringCloudBus<a href=\"#什么是springcloudbus\" title=\"什么是SpringCloudBus\"></a></h1><p>消息总线</p>\n<h1 id=\"如何接入springcloudbus\">如何接入SpringCloudBus<a href=\"#如何接入springcloudbus\" title=\"如何接入SpringCloudBus\"></a></h1><p>SpringCloudBus需要基于消息中间件，rabbitmq或者kafka，本次选择的是rabbitmq。具体rabbitmq的安装可以查看另外一篇博文。</p>\n<h2 id=\"修改configserver项目\">修改ConfigServer项目<a href=\"#修改configserver项目\" title=\"修改ConfigServer项目\"></a></h2><p>pom.xml新增依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>application.yml新增配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">rabbitmq:</span> <span class=\"comment\">#rabbitmq配置</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"number\">47.106</span><span class=\"number\">.35</span><span class=\"number\">.110</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">5672</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">guest</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">guest</span></span><br><span class=\"line\"> <span class=\"attr\">management:</span></span><br><span class=\"line\">  <span class=\"attr\">endpoints:</span></span><br><span class=\"line\">    <span class=\"attr\">web:</span></span><br><span class=\"line\">      <span class=\"attr\">exposure:</span></span><br><span class=\"line\">        <span class=\"attr\">include:</span> <span class=\"string\">bus-refresh</span> <span class=\"comment\">#开启bus-refresh节点</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改configclient项目\">修改ConfigClient项目<a href=\"#修改configclient项目\" title=\"修改ConfigClient项目\"></a></h2><p>pom.xml新增依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>application.yml新增配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">rabbitmq:</span> <span class=\"comment\">#rabbitmq配置</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"number\">47.106</span><span class=\"number\">.35</span><span class=\"number\">.110</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">5672</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">guest</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">guest</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\">测试<a href=\"#测试\" title=\"测试\"></a></h2><ol><li><p>去数据库把alipay.key的value值改成hello2</p></li><li><p>用post方式调用ConfigClient的接口<a href=\"http://localhost:8888/actuator/bus-refresh\" target=\"_blank\">http://localhost:8888/actuator/bus-refresh</a>, 可以看见返回httpcode码204表示刷新成功</p></li><li><p>访问ConfigClient的测试接口发现alipay.key的值已经修改为hello2</p></li></ol><h1 id=\"参考\">参考<a href=\"#参考\" title=\"参考\"></a></h1><p><a href=\"https://cloud.spring.io/spring-cloud-static/Hoxton.RELEASE/reference/htmlsingle/#spring-cloud-bus\" target=\"_blank\">https://cloud.spring.io/spring-cloud-static/Hoxton.RELEASE/reference/htmlsingle/#spring-cloud-bus</a></p>\n","prev":{"title":"SpringBootActuator","link":"2020/03/15/SpringBootActuator"},"next":{"title":"SpringCloudConfig","link":"2020/03/12/SpringCloudConfig"},"plink":"https://blog.bugbak.com/2020/03/14/SpringCloudBus/","toc":[{"id":"什么是springcloudbus","title":"什么是SpringCloudBus","index":"1"},{"id":"如何接入springcloudbus","title":"如何接入SpringCloudBus","index":"2","children":[{"id":"修改configserver项目","title":"修改ConfigServer项目","index":"2.1"},{"id":"修改configclient项目","title":"修改ConfigClient项目","index":"2.2"},{"id":"测试","title":"测试","index":"2.3"}]},{"id":"参考","title":"参考","index":"3"}],"reward":true,"copyright":{"author":"Dz","link":"<a href=\"https://blog.bugbak.com/2020/03/14/SpringCloudBus/\" title=\"SpringCloudBus\">https://blog.bugbak.com/2020/03/14/SpringCloudBus/</a>","license":"本博客所有文章除特别声明外，均采用(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>)许可协议，转载请注明来源<a href=\"https://blog.bugbak.com\" rel=\"nofollow\" target=\"_blank\">BugBak</a>"}}